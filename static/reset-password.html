<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Reset Password â€” AI Creative Review</title>
<style>
  :root {
    --bg: #0f0f1a; --surface: #1a1a2e; --border: #2a2a3e; --text: #e0e0e0;
    --text2: #888; --accent: #818cf8; --green: #34d399; --red: #f87171;
  }
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    background: var(--bg); color: var(--text); min-height: 100vh;
    display: flex; flex-direction: column; align-items: center; justify-content: center;
  }
  .card {
    background: var(--surface); border: 1px solid var(--border); border-radius: 16px;
    padding: 40px; max-width: 400px; width: 90%; text-align: center;
  }
  h2 { font-size: 24px; margin-bottom: 8px; }
  .subtitle { color: var(--text2); font-size: 14px; margin-bottom: 24px; }
  .form { display: flex; flex-direction: column; gap: 12px; }
  .form input {
    padding: 12px 16px; border-radius: 8px; border: 1px solid var(--border);
    background: var(--bg); color: var(--text); font-size: 14px; outline: none; width: 100%;
  }
  .form input:focus { border-color: var(--accent); }
  .form input::placeholder { color: #555; }
  .btn {
    padding: 14px; border-radius: 8px; border: none;
    background: var(--accent); color: #000; font-size: 15px; font-weight: 600;
    cursor: pointer; transition: all 0.2s; width: 100%;
  }
  .btn:hover { opacity: 0.9; }
  .btn:disabled { opacity: 0.5; cursor: not-allowed; }
  .error { color: var(--red); font-size: 13px; margin-bottom: 12px; display: none; }
  .success { color: var(--green); font-size: 13px; margin-bottom: 12px; display: none; }
  .hint { font-size: 12px; color: var(--text2); margin-top: 4px; text-align: left; }
  .back { margin-top: 16px; font-size: 13px; color: var(--text2); }
  .back a { color: var(--accent); text-decoration: underline; }
</style>
</head>
<body>

<div class="card">
  <h2>Reset Password</h2>
  <p class="subtitle">Choose a new password for your account.</p>
  <div class="error" id="error"></div>
  <div class="success" id="success"></div>

  <form class="form" id="resetForm" onsubmit="return false" style="display:none">
    <input type="password" id="newPassword" placeholder="New password" required minlength="8">
    <input type="password" id="confirmPassword" placeholder="Confirm new password" required minlength="8">
    <p class="hint">Must be at least 8 characters with at least one letter and one number.</p>
    <button type="submit" class="btn" id="btnReset">Reset Password</button>
  </form>

  <div id="noToken" style="display:none">
    <p class="subtitle">This reset link is invalid or has expired.</p>
  </div>

  <div class="back"><a href="/">Back to sign in</a></div>
</div>

<script>
const $ = id => document.getElementById(id);
const params = new URLSearchParams(window.location.search);
const token = params.get('token');

if (!token) {
  $('noToken').style.display = 'block';
} else {
  $('resetForm').style.display = 'flex';
}

$('resetForm').addEventListener('submit', async () => {
  const password = $('newPassword').value;
  const confirm = $('confirmPassword').value;
  $('error').style.display = 'none';
  $('success').style.display = 'none';

  if (password.length < 8) {
    $('error').textContent = 'Password must be at least 8 characters.';
    $('error').style.display = 'block';
    return;
  }
  if (password !== confirm) {
    $('error').textContent = 'Passwords do not match.';
    $('error').style.display = 'block';
    return;
  }

  const btn = $('btnReset');
  btn.disabled = true;
  btn.textContent = 'Resetting...';

  try {
    const res = await fetch('/auth/reset-password', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ token, password }),
    });
    const data = await res.json();
    if (res.ok) {
      $('success').textContent = data.message || 'Password reset! Redirecting...';
      $('success').style.display = 'block';
      $('resetForm').style.display = 'none';
      setTimeout(() => { window.location.href = '/'; }, 2000);
    } else {
      $('error').textContent = data.detail || 'Failed to reset password.';
      $('error').style.display = 'block';
    }
  } catch (e) {
    $('error').textContent = 'Network error. Please try again.';
    $('error').style.display = 'block';
  } finally {
    btn.disabled = false;
    btn.textContent = 'Reset Password';
  }
});
</script>
</body>
</html>
